P4233 射命丸文的笔记

竞赛图：有向的完全图，任意不同两点间有且仅有 1 条有向边。

性质：

1. 竞赛图缩点后形成的图类似于一条链，即 $S_1\to S_2\to \cdots\to S_k$，其中 $S_i$ 向 $S_j$ 连边 $(i<j)$。
2. 竞赛图一定有哈密顿路径，竞赛图有哈密顿回路的充要条件是它强连通。

那么本题的解法如下：

期望值可以通过（所有 $n$ 个点的竞赛图的哈密顿回路总数）除以（有哈密顿回路的竞赛图个数）求出。

对于分子，枚举哈密顿回路（就是个 $n$ 个点的环排列），再枚举除此以外其余边的方向，可以得到答案为

$$
(n-1)!2^{\binom{n}{2}-n}
$$

对于分母，设 $F(x)$ 是有标号强连通竞赛图的 EGF（以点数为组合对象），$G(x)$ 是有标号竞赛图的 $EGF$，$G(x)$ 易求为

$$
G(x)=\sum_{i=1}2^{\binom{n}{2}}\dfrac{x^i}{i!}
$$

而根据上面的理论，有标号竞赛图可以看作是若干有标号强连通竞赛图序列拼接而成，于是有

$$
G(x)=\sum_{i=1}F^i(x)=\dfrac{F(x)}{1-F(x)}
$$

于是 $F(x)=1-\dfrac{1}{1+F(x)}$