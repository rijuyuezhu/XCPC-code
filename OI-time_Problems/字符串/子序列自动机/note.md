子序列自动机是一个 DAG，它每条路径表示一个本质不同的子序列。

对于串 $S_{1\cdots n}$ 建立子序列自动机，不妨设状态 0 是初始状态，状态 $i$ 是 $S_i$ 代表的状态。转移函数如下：

$$
f(i,c)=\min\{j|j>i,S_j=c\}
$$

如果要用子序列自动机作子序列匹配，若预处理出转移边，可以在预处理 $O(n|\Sigma|)$，单次 $O(m)$ 的复杂度内解决本题。

如果字符集比较大怎么办？有两种方法：

1. 使用可持久化线段树辅助转移（注意到 $i$ 和 $i-1$ 的转移函数至多一位不同）。预处理 $O(n\log n)$。（设 $\Sigma \sim n$，否则一般可以离散化）
2. 二分，将每个不同的 $c$ 存到不同的 vector 里，二分找最小值。预处理 $O(n)$。

上面两种方法单次查询都是 $O(m\log n)$ 的。