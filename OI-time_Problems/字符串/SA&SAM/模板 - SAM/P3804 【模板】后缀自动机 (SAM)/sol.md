一个很有意思的题。

如果只有一个串，是 SAM 的经典题。只需要 DAG 上计数或对每个状态累加。

但现在有多个串。不要想当然地觉得用广义 SAM。考虑每个串建一个 SAM，那么在单独每个串的转移肯定是正确的。考虑串之间的转移。比如我要从第 $i$ 个串转移到第 $i+1$ 个串。分两种情况：

- 第 $i+1$ 个串不选空串，那么将 $i$ 串 SAM 的每个不含 $c$ 转移的节点连到 $i+1$ 串 SAM 的根节点的 $c$ 转移上去，这样可以保证不重复（即先在本串优先转移）。
- 是空串（还是本串优先转移，故我们要保证 $i+1$ 串不含 $c$ 转移），我们考虑直接越过 $i+1$ 串往后连。可以倒序遍历，用类似于链表的思想进行连边。