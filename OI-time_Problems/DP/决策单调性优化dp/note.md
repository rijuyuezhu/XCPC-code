1. [1D/1D](#1d1d)
2. [2D/1D](#2d1d)
3. [1D/1D 利用决策单调性优化的两种方法](#1d1d-利用决策单调性优化的两种方法)
   1. [二分栈](#二分栈)
   2. [分治](#分治)

决策单调性优化，顾名思义，利用决策点的单调性，避免决策点的重复抉择。

## 1D/1D
形如 $f_i=\min_{L_i\le j\le R_i}\{f_j+w(j,i)\}$ 的方程，被称为 1D/1D 动态规划。其中 $L_i,R_i$ 单调不降，而 $w(j,i)$ 决定了决策点的选择。

假如对于 $f_i$ 的最佳决策点被记为 $k_i$，则决策单调性可以描述为：$\forall p\le q$，$k_p\le k_q$。

这个似乎难以判断，但我们有一个东西，叫做四边形不等式：

若对于 $\forall i<j<k<l$，有 $w(i,k)+w(j,l)\le w(i,l)+w(j,k)$，（记为：交叉优于包含），则称 $w$ 满足四边形不等式。

- 四边形不等式的另一种形式：

$$
\forall i<j,w(i,j)+w(i+1,j+1)\le w(i,j+1)+w(i+1,j)
$$

于是我们有这样一个性质：当四边形不等式成立时，1D/1D 动规有决策单调性。

推广：

这样的方程：$f(i)=\min_{j<i}\{g(j)+w(j,i)\}$，其中 $g(j)$ 与 $i$ 无关，若 $w(j,i)$ 满足四边形不等式，那么也是有决策单调性的。
- 1D/1D dp的总结：

一般有以下几种：

1. $w(j,i)$ 只与 $i$ 或只与 $j$ 单独有关，并且 $j$ 的决策范围是一个单调的区间，那么可以使用单调队列进行维护。
2. $w(j,i)$ 中除了 $i$、$j$ 的项以外，还可能有 $F(i)*G(j)$ 的项，可以使用斜率优化。
3. 转移的范围有一堆奇怪的限制，可能可以转化为数据结构问题，用数据结构维护。
4. $w(j,i)$ 满足四边形不等式，使用决策单调性。


## 2D/1D

类似于石子合并的转移式：

$$
f_{l, r}=\min_{k=l}^{r-1}\{f_{l,k}, f_{k+1,r}\}+w(l,r)
$$

如果 $w(l,r)$ 满足以下两个条件：

1. 区间包含单调性，$i<j<k<l,w(j,k)\le w(i,l)$ 即“小范围代价小”。
2. 四边形不等式，同上，交叉优于包含。

那么 $f_{l,r}$ 满足四边形不等式，证明可见 OI-Wiki。

容易证明，若 $f_{l,r}$ 满足四边形不等式，则：$l$ 或 $r$ 不降时，决策点单调不降。

**变式：**

对于这样一个转移 $f_{i,j}=\min_{k\le j}\{f_{i-1,k}\}+w(k,j)$，可以把它看成二维的东西，于是可以像上面一样套用结论。

## 1D/1D 利用决策单调性优化的两种方法

### 二分栈

这里的二分指找决策临界点，这里的栈指单调栈，可能还有会用到单调队列。

还是这个一般化的方程：$f_i=\min_{j<i}\{f(j)+w(j,i)\}$，如果有决策单调性，则：

对于相邻的两个决策点（即实际上参与决策的 $j$）$j_x,j_{x+1}$，它们会分别贡献一个 $i$ 的区间，并且相邻，假如分界点为 $k_{x,x+1}$，即 $j_x$ 贡献的所有 $i$ 都有 $i\le k_{x,x+1}$；相应地，$j_{x+1}$ 都有 $i>k_{x,x+1}$。容易发现，这个 $k_{x,x+1}$ 容易二分得出。

我们用单调队列+二分来解决。这个单调队列维护决策的单调性。

我们就以上面的那个方程为例：

1. 检查队首是否过时，即队首 $h$ 是否有 $k_{h,h+1}<i$，如果是的话，说明 $h$ 已经不再是最优决策了，出队。
2. 现在队首就是最优决策点了，转移。
3. 要把 $i$ 加入队。检查队尾 $t$，若有 $k_{t-1,t}\ge k_{t,i}$，则 $t$ 的最优决策区间就变成了空区间！直接扔掉 $t$。最后就可以加入 $i$ 了。

当然，要根据实际的转移方程进行一些转化。

### 分治

为了方便，用 $f[l,r]$ 表示 $\{f_i|l\le i\le r\}$。

如果我们已知 $f[l,r]$ 的最佳决策点均位于 $[L,R]$，且 $f_{m}$ 的最佳决策点位于 $M$（其中 $m=(l+r)/2$），于是：

$f[l,m]$ 的最佳决策点位于 $[L,M]$；$f[m+1,r]$ 的最佳决策点位于 $[M,R]$。所以可以分治+dp。

代码很好写。上面两种的复杂度都是 $O(n\log n)$。