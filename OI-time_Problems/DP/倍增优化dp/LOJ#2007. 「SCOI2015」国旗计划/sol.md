看到环，先化环为链：倍长原序列，同时把各区间也复制一下。以下的坐标、区间的大小等都基于环意义下。

由于区间不会互相包含，则若两个区间 $[l_1,r_1],[l_2,r_2]$ 满足 $l_1<l_2$ 则有 $r_1 < r_2$。

于是，从某点 $x$ 要往右走得尽量远，就要选择一个 $l\le x$ 且 $l$ 尽量大的区间。

设 $f(i,j)$ 表示从 $i$ 区间出发，后继走 $j$ 个区间（不包括 $i$ 区间），能够的着的左端点最大的区间编号。这个可以直接转移，即，$f(i,j)=f(f(i,j-1),1)$。对于 $i$ 的答案即为 $1+\min\{j|r_{f(i,j)}-l_i\ge M\}$。总时间复杂度为 $O(n^2+)$。

发现可以倍增解决，$f(i,2^k)=f(f(i,2^{k-1}), 2^{k-1})$，于是可以优化复杂度为 $O(n\log n)$。