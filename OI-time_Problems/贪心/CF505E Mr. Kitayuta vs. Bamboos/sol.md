考虑二分答案，即 $m$ 轮操作后 $\max$ 是否可能 $\le mid$。

如果考虑顺次枚举模拟，发现这个对 0 取 $\max$ 的操作令人窒息，考虑倒着来。

以下是倒过来的过程。贪心地钦定 $n$ 个数都是 $mid$，每次操作先让每个 $h_i$ 减去 $a_i$，再选择某 $k$ 个 $h$ 加上 $p$。有以下两个限制：

- 任意时刻 $h_i\ge 0$。
- $m$ 轮操作后满足 $h_i\ge inith_i$。
  
采用贪心的方法，把所有 $m$ 次操作结束后 （如果不加任何的 $p$ 就能达到）$< inith_i$ 的 $i$ 都放入一个堆中，按照（如果不加任何的 $p$）到达 $<0$ 的状态需要的回合数排序，贪心地选择即可。

总时间复杂度为 $O((n+mk)\log n\log V)$